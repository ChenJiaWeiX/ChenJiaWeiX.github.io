<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>模块化 | CJW</title>
    <meta name="description" content="普通，并没有错也没有不好。它只是普通。">
    
    
    <link rel="preload" href="/assets/css/0.styles.cc2a2ebf.css" as="style"><link rel="preload" href="/assets/js/app.6d5e46ba.js" as="script"><link rel="preload" href="/assets/js/6.7c6f831e.js" as="script"><link rel="prefetch" href="/assets/js/2.8b5c48bc.js"><link rel="prefetch" href="/assets/js/3.916a7747.js"><link rel="prefetch" href="/assets/js/4.c5adfb7e.js"><link rel="prefetch" href="/assets/js/5.d4228ec3.js"><link rel="prefetch" href="/assets/js/7.693a13b7.js"><link rel="prefetch" href="/assets/js/8.68a8120c.js"><link rel="prefetch" href="/assets/js/9.73d0e2bb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cc2a2ebf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">CJW</span></a> <div class="links" style="max-width:nullpx;"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/IT/JavaScript/" class="nav-link router-link-active">编程</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/IT/JavaScript/" class="nav-link router-link-active">编程</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/IT/JavaScript/" class="sidebar-link">README</a></li><li><a href="/blog/IT/JavaScript/面向对象.html" class="sidebar-link">面向对象</a></li><li><a href="/blog/IT/JavaScript/模块化.html" class="active sidebar-link">模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/IT/JavaScript/模块化.html#零-提纲挈领" class="sidebar-link">零. 提纲挈领</a></li><li class="sidebar-sub-header"><a href="/blog/IT/JavaScript/模块化.html#一-什么是模块化" class="sidebar-link">一. 什么是模块化</a></li><li class="sidebar-sub-header"><a href="/blog/IT/JavaScript/模块化.html#二-adm规范" class="sidebar-link">二. ADM规范</a></li><li class="sidebar-sub-header"><a href="/blog/IT/JavaScript/模块化.html#三-require-js-的用法" class="sidebar-link">三. require.js 的用法</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="模块化"><a href="#模块化" aria-hidden="true" class="header-anchor">#</a> 模块化</h1> <blockquote><p>本篇笔记参考阮一峰的《JavaScript模块化编程》</p></blockquote> <h2 id="零-提纲挈领"><a href="#零-提纲挈领" aria-hidden="true" class="header-anchor">#</a> 零. 提纲挈领</h2> <h3 id="什么是模块化"><a href="#什么是模块化" aria-hidden="true" class="header-anchor">#</a> 什么是模块化</h3> <ol><li><a href="#%E5%8E%9F%E5%A7%8B%E5%86%99%E6%B3%95">原始写法</a></li> <li><a href="#%E5%AF%B9%E8%B1%A1%E5%86%99%E6%B3%95">对象写法</a></li> <li><a href="#%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%E5%86%99%E6%B3%95">立即执行函数写法</a></li> <li><a href="#%E6%94%BE%E5%A4%A7%E6%A8%A1%E5%BC%8F">放大模式</a></li> <li><a href="#%E5%AE%BD%E6%94%BE%E5%A4%A7%E6%A8%A1%E5%BC%8F">宽放大模式</a></li> <li><a href="#%E8%BE%93%E5%85%A5%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">输入全局变量</a></li></ol> <h3 id="amd-规范"><a href="#amd-规范" aria-hidden="true" class="header-anchor">#</a> AMD 规范</h3> <ol><li><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E8%A7%84%E8%8C%83">模块化的规范</a></li> <li><a href="#commonjs">CommonJS</a></li> <li><a href="#amd%E8%A7%84%E8%8C%83">AMD规范</a></li></ol> <h3 id="require-js-的用法"><a href="#require-js-的用法" aria-hidden="true" class="header-anchor">#</a> require.js 的用法</h3> <ol><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8requirejs">为什么使用requireJS</a></li> <li><a href="#requirejs%E7%9A%84%E5%8A%A0%E8%BD%BD">requireJS的加载</a></li> <li><a href="#%E4%B8%BB%E6%A8%A1%E5%9D%97%E7%9A%84%E5%86%99%E6%B3%95">主模块的写法</a></li> <li><a href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%B7%AF%E5%BE%84">模块的加载路径</a></li> <li><a href="#%E5%8A%A0%E8%BD%BDamd%E5%86%99%E6%B3%95%E7%9A%84%E6%A8%A1%E5%9D%97">加载AMD写法的模块</a></li> <li><a href="#%E5%8A%A0%E8%BD%BD%E9%9D%9Eamd%E5%86%99%E6%B3%95%E7%9A%84%E6%A8%A1%E5%9D%97">加载非AMD写法的模块</a></li> <li><a href="#requirejs%E6%8F%92%E4%BB%B6">requireJS 插件</a></li></ol> <h2 id="一-什么是模块化"><a href="#一-什么是模块化" aria-hidden="true" class="header-anchor">#</a> 一. 什么是模块化</h2> <p><strong>说明</strong></p> <ul><li>把实现某个功能的函数们放到一起就是一个模块，而模块的数量多了就需要规范。</li> <li>这篇文章讲的是【js 模块化】的原始与发展的过程。</li> <li>模块化引用使 js 文件以异步加载。这样就使浏览器能够快速渲染页面，而不用所有文件都加载才显示页面内容。</li></ul> <h3 id="原始写法"><a href="#原始写法" aria-hidden="true" class="header-anchor">#</a> <strong>原始写法</strong></h3> <ul><li>只要把不同的函数简单的放在一起，就算是一个模块</li> <li>但这样会污染全局。无法保证不与其它命名发生冲突。看不出模块成员的直接关系。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h3 id="对象写法"><a href="#对象写法" aria-hidden="true" class="header-anchor">#</a> 对象写法</h3> <ul><li>为了解决说明的缺点，可以把模块写到一个对象里，所有的模块成员都放到这个对象里面</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
    _count <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    m1 <span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    m2 <span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> module<span class="token punctuation">.</span>count <span class="token punctuation">)</span>
</code></pre></div><ul><li>但是这样的话，对象的私有成员被暴露，可以被外部改写</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>_count <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="立即执行函数写法"><a href="#立即执行函数写法" aria-hidden="true" class="header-anchor">#</a> 立即执行函数写法</h3> <ul><li>用立即执行函数写法，可以避免暴露成员</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> module1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">m1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">m2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        m1 <span class="token punctuation">:</span> m1<span class="token punctuation">,</span>
        m2 <span class="token punctuation">:</span> m2
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module1<span class="token punctuation">.</span>_count<span class="token punctuation">)</span>
</code></pre></div><p><strong>关键词</strong></p> <ul><li>函数表达式、匿名函数、return、私有成员</li></ul> <h3 id="放大模式"><a href="#放大模式" aria-hidden="true" class="header-anchor">#</a> 放大模式</h3> <ul><li>如果一个模块很大，必须分成几个部分，或者一个模块需要继承另一个模块，这时就可以采用放大模式</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> module1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">m1</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">m2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        m1 <span class="token punctuation">:</span> m1<span class="token punctuation">,</span>
        m2 <span class="token punctuation">:</span> m2
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> module1 <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>mod<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mod<span class="token punctuation">.</span><span class="token function-variable function">m3</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'m3'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> mod<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">(</span>module1<span class="token punctuation">)</span>
module1<span class="token punctuation">.</span><span class="token function">m3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="宽放大模式"><a href="#宽放大模式" aria-hidden="true" class="header-anchor">#</a> 宽放大模式</h3> <ul><li>与 &quot;放大模式&quot; 相比，＂宽放大模式＂就是 &quot;立即执行函数&quot; 的参数可以是空对象。</li> <li>在浏览器环境中，模块的各个部分通常都是从网上获取的，有时无法知道哪个部分会先加载。如果采用上一节的写法，第一个执行的部分有可能加载一个不存在空对象，这时就要采用 &quot;宽放大模式&quot;。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> module1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>mod<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> mod<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>module1 <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="输入全局变量"><a href="#输入全局变量" aria-hidden="true" class="header-anchor">#</a> 输入全局变量</h3> <ul><li>独立性是模块的重要特点，模块内部最好不与程序的其他部分直接交互。</li> <li>为了在模块内部调用全局变量，必须显式地将其他变量输入模块。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> module1 <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> $<span class="token punctuation">,</span><span class="token constant">YAHOO</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>jQuery<span class="token punctuation">,</span> <span class="token constant">YAHOO</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><code>上面的 module1 模块需要使用 jQuery 库和 YUI 库，就把这两个库（其实是两个模块）当作参数输入 module1。</code></li> <li><code>这样做除了保证模块的独立性，还使得模块之间的依赖关系变得明显。</code></li></ol> <h2 id="二-adm规范"><a href="#二-adm规范" aria-hidden="true" class="header-anchor">#</a> 二. ADM规范</h2> <h3 id="模块化的规范"><a href="#模块化的规范" aria-hidden="true" class="header-anchor">#</a> 模块化的规范</h3> <ul><li>想用什么功能，就可以加载什么模块，但这需要统一的规范，否则各用自己的写法就会出现问题。</li> <li>JS 有两种模块化规范： CommonJS 和 AMD. 主要是用 AMD，但先了解 CommonJS。</li> <li>Node.js 是参照 CommonJS 规范实现的</li></ul> <h3 id="commonjs"><a href="#commonjs" aria-hidden="true" class="header-anchor">#</a> CommonJS</h3> <ul><li>CommonJS 中有个全局性方法 require() 用于加载模块, 假定有一个数学模块 math.js， 可以像下面这样加载</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'math'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">//5</span>
</code></pre></div><ol><li><code>CommenJS 由于需要 math.js 加载完毕才能使用其中的功能，所以 CommonJS 不适用于浏览器环境。</code></li> <li><code>因此浏览器端的模块，不能使用 '同步加载(synchronous)'， 需要采用 '异步加载(asynchronous)'。</code></li> <li><code>这就是 AMD 规范诞生的背景。</code></li></ol> <h3 id="amd规范"><a href="#amd规范" aria-hidden="true" class="header-anchor">#</a> AMD规范</h3> <ul><li>AMD 是 &quot;Asynchronous Module Definition&quot; 的缩写，意思就是 &quot;异步模块定义&quot;。</li> <li>它采用异步方式加载模块，模块加载时不影响它后面语句的运行。比较适合浏览器环境。</li> <li>所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</li> <li>AMD 也采用 require() 语句加载模块，但是不同于 CommonJS，它要求两个参数：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><code>第一个参数 [module]，是一个数组，里面的成员就是要加载的模块；第二个参数 callback，则是加载成功之后的回调函数。</code></li></ol> <ul><li>如果将前面的代码改写成 AMD 形式，就是下面这样：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'math'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>math<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><code>math.add() 与 math 模块加载不是同步的，浏览器不会发生假死。</code></li> <li><code>目前，主要有两个 Javascript 库实现了 AMD 规范：require.js 和 curl.js。</code></li></ol> <h2 id="三-require-js-的用法"><a href="#三-require-js-的用法" aria-hidden="true" class="header-anchor">#</a> 三. require.js 的用法</h2> <h3 id="为什么使用requirejs"><a href="#为什么使用requirejs" aria-hidden="true" class="header-anchor">#</a> 为什么使用requireJS</h3> <ul><li>当引用文件越多的时候，网页失去响应的时间就会越长。</li> <li>由于 js 文件之间存在依赖关系，应此需要保证加载顺序。当依赖关系复杂的时候，代码的编写和维护都会变得困难。</li> <li>require.js 实现了文件的异步加载，避免网页失去响应。</li> <li>管理了模块之间的依赖性，便于的编写和维护</li></ul> <h3 id="requirejs的加载"><a href="#requirejs的加载" aria-hidden="true" class="header-anchor">#</a> requireJS的加载</h3> <ul><li>首先需要下载 require.js 文件。然后在页面中引用。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/require.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>加载这个文件也可能造成页面失去响应。解决办法有两个：一个是放在网页底部，一个是写成下面这样</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/require.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defer</span> <span class="token attr-name">async</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>async 属性表明这个文件需要异步加载，避免网页失去响应。IE 不支持这个属性，只支持 defer，所以把 defer 也写上。</code></p> <ul><li>加载 require.js 之后，下一步是加载自己的文件。假定代码文件是 main.js 那么：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/require.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-main</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>data-main 属性的作用是，指定网页程序的主模块。在上例中，就是 js 目录下面的 main.js，这个文件会第一个被 require.js 加载。由于 require.js 默认的文件后缀名是 js，所以可以把 main.js 简写成 main。</code></p> <h3 id="主模块的写法"><a href="#主模块的写法" aria-hidden="true" class="header-anchor">#</a> 主模块的写法</h3> <ul><li>main.js 可称为【主模块】，意思是整个页面的入口代码。所有代码从这里开始运行。</li> <li>如果代码不依赖其它任何模块可以直接渲染 JS 代码，但这样的话就没必要用到 require.js 了。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>真正常见的情况是，主模块依赖于其他模块，这时就要使用 AMD 规范定义的的 require() 函数。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'moduleA'</span><span class="token punctuation">,</span> <span class="token string">'moduleB'</span><span class="token punctuation">,</span> <span class="token string">'moduleC'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>moduleA<span class="token punctuation">,</span> moduleB<span class="token punctuation">,</span> moduleC<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><code>require() 函数接受两个参数。第一个参数是一个数组，表示所依赖的模块，上例就是 ['moduleA', 'moduleB', 'moduleC']，即主模块依赖这三个模块；</code></li> <li><code>第二个参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。</code></li> <li><code>加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块。</code></li></ol> <ul><li>require() 异步加载 moduleA，moduleB 和 moduleC，浏览器不会失去响应；它指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。</li> <li>假定主模块依赖 jquery、underscore 和 backbone 这三个模块，main.js 就可以这样写：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">,</span> <span class="token string">'underscore'</span><span class="token punctuation">,</span> <span class="token string">'backbone'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>$<span class="token punctuation">,</span> _<span class="token punctuation">,</span> Backbone<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><code>require.js 会先加载 jQuery、underscore 和 backbone，然后再运行回调函数。主模块的代码就写在回调函数中。</code></li></ol> <h3 id="模块的加载路径"><a href="#模块的加载路径" aria-hidden="true" class="header-anchor">#</a> 模块的加载路径</h3> <ul><li>require( [ ], fn(){} ) 是假定要加载的文件与 require.js 都在同一个目录，然后自动加载文件。</li> <li>使用 require.config() 方法，可以对模块的加载路径进行定义。</li> <li>require.config() 就写在主模块（如main.js) 的头部。参数是一个对象，它的 paths 属性指定各个模块的加载路径。如：</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    paths<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;jquery&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;lib/jquery.js&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;underscore&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;lib/underscore.min&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;backbone&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;lib/backbone.min&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>另一种方式是改变基目录（baseUrl）</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    baseUrl<span class="token punctuation">:</span> <span class="token string">&quot;js/lib&quot;</span><span class="token punctuation">,</span>
    paths<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;jquery&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jquery.min&quot;</span><span class="token punctuation">,</span>
　　　　　<span class="token string">&quot;underscore&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;underscore.min&quot;</span><span class="token punctuation">,</span>
　　　　　<span class="token string">&quot;backbone&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;backbone.min&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>如果某个模块在其它主机上，也可以指定它的网址</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    paths<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;jquery&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>require.js 要求每个模块是一个单独的js文件。这样的话如果加载多个模块就会发送多次 http 请求，影响网页加载速度。因此 require.js 提供了一个<a href="http://www.requirejs.cn/" target="_blank" rel="noopener noreferrer">优化工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，当模块部署完毕之后可以用这个工具把多个模块合并在一个文件中，减少http请求。</li></ul> <h3 id="加载amd写法的模块"><a href="#加载amd写法的模块" aria-hidden="true" class="header-anchor">#</a> 加载AMD写法的模块</h3> <ul><li>require.js 加载的模块，采用的是 AMD 规范。所以被引用的模块也必须按照 AMD 的规定来写。</li> <li>假定有一个 main.js 文件，引用了 a.j 模块，那么 a.js 需要这样写</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// a.js</span>
<span class="token function">define</span> <span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">aa</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        aa <span class="token punctuation">:</span> aa
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>main.js 加载 math 文件的方式如下</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token function">require</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{</span>
    math<span class="token punctuation">.</span><span class="token function">aa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>如果 a.js 文件还依赖其它模块，那么 define() 的第一个参数，必须是一个数组，指明该模块的依赖性</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// a.js</span>
<span class="token function">define</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">aa</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">.</span><span class="token function">bb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        aa <span class="token punctuation">:</span> aa
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>当 reqiue() 加载 a 模块的时候，会先加载 b.js 文件</code></p> <h3 id="加载非amd写法的模块"><a href="#加载非amd写法的模块" aria-hidden="true" class="header-anchor">#</a> 加载非AMD写法的模块</h3> <ul><li>理论上 require.js 加载的模块必须是按照 AMD 规范用 define() 定义的模块。虽然有的库（如 jquire）符合 AMD 规范。但更多的库并不符合。所以需要在 require() 加载模块之前，先用 require.config() 定义它们的特征</li> <li>require.config() 接受一个配置对象，里面的属性除了 paths 之外，还有一个 shim 属性，用于配置不兼容的模块.</li> <li>不如 underscore 和 backbone 这两个库，都没有采用 AMD 规范编写。如果要加载的话，首先定义它们的特征。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    shim<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'underscore'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            exports<span class="token punctuation">:</span> <span class="token string">'_'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'backbone'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            deps<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'underscore'</span><span class="token punctuation">,</span> <span class="token string">'jquery'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            exports<span class="token punctuation">:</span> <span class="token string">'Backbone'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><code>每个模块要定义 exports 值 (输出的变量名），表明这个模块外部调用时的名称；</code></li> <li><code>deps 数组是表明该模块的依赖性。</code></li></ol> <ul><li>又如 jquery 插件可以这样定义</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>shim<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'jquery.scroll'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        deps<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        exprots<span class="token punctuation">:</span> <span class="token string">'jQuery.fn.scroll'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="requirejs插件"><a href="#requirejs插件" aria-hidden="true" class="header-anchor">#</a> requireJS插件</h3> <ul><li>require.js 还提供一系列<a href="https://github.com/jrburke/requirejs/wiki/Plugins" target="_blank" rel="noopener noreferrer">插件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，实现一些特定的功能。</li> <li>domready 插件，可以让回调函数在页面 DOM 结构加载完成后再运行。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'domready!'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// ..</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>text 和 image 插件，则是允许 require.js 加载文本和图片文件。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
	<span class="token string">'text!review.txt'</span><span class="token punctuation">,</span>
	<span class="token string">'image!cat.jpg'</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token keyword">function</span><span class="token punctuation">(</span>review<span class="token punctuation">,</span>cat<span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>review<span class="token punctuation">)</span><span class="token punctuation">;</span>
	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>cat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>类似的插件还有 json 和 mdown，用于加载 json 文件和 markdown 文件。</li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/6.7c6f831e.js" defer></script><script src="/assets/js/app.6d5e46ba.js" defer></script>
  </body>
</html>
